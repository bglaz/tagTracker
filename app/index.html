<!DOCTYPE HTML>
<html lang="en">
	<head>
		<meta charset="utf-8">
    	<title>TagTracker</title>
    	<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<link href="/css/bootstrap.min.css" rel="stylesheet" media="screen">
		<link href="css/bootstrap-responsive.min.css" rel="stylesheet" media="screen">
	</head>
	<body style="padding-top: 60px;">

		<div class="navbar navbar-inverse navbar-fixed-top">
      		<div class="navbar-inner">
        		<div class="container">
          			<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
			            <span class="icon-bar"></span>
			            <span class="icon-bar"></span>
			            <span class="icon-bar"></span>
          			</a>
          			<a class="brand" href="#">TagTracker</a>
         			<div class="nav-collapse collapse">
           				<ul class="nav">
			              <li class="active"><a href="#">Home</a></li>
			              <li><a href="#about">About</a></li>
            			</ul>
          			</div>
       		 	</div>
      		</div>
    	</div>

   	 	<div class="container">

      		<h1>TagTracker</h1>
      		
      		<div class="row-fluid">
				<div class="span12">
					<form class="form-inline">
						<input id="tagName" type="text" />
						<input type="button" id="track_tag_btn" class="btn btn-primary" value="Track Tag" />
					</form>
					<hr />
				</div>
			</div>

			<div class="row-fluid">
				<div class="span12">
					<div id="results">

					</div>
				</div>
			</div>

    	</div>


    	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
		<script src="/js/mustache.js"></script>
		<script src="/js/bootstrap.min.js"></script>
		<script src="/socket.io/socket.io.js"></script>

		<script id="tweetTpl" type="text/tweetTpl">
			<div class="media" style="display: none;">
				<a class="pull-left" href="http://www.twitter.com/{{user.screen_name}}">
					<img class="media-object" style="width: 48px; height: 48px; background-color: #CCC;" src="{{user.profile_image_url}}" />
				</a>
				<div class="media-body">
					<h4 class="media-heading">
						<a href="http://www.twitter.com/{{user.screen_name}}">@{{user.screen_name}}</a>
					</h4>
					<p>
						{{{text}}}
					</p>
				</div>
			</div>
		</script>

		<script>
		  	$(function() {

		  		//compile templates
		  		var templates = ['tweet'];
		  		var compiledTemplates = {};
		  		for(var i = 0, len = templates.length; i < len; i++) {
		  			var tmp_name = templates[i];
		  			compiledTemplates[tmp_name] = Mustache.compile($('#' + tmp_name + 'Tpl').html());
		  		}

		  		//create a blank queue of tweet objects
		  		var tweetsQueue = [];

		  		//set up a socket to receive tweet data
		  		var socket = io.connect('http://localhost');
			  	socket.on('tweetData', function (data) {
			  		if(data.text) {
			  			console.log(data);
			  			tweetsQueue.push(data);
			    	}
			  	});

			  	//function to render tweets
			  	var renderTweet = function() {
			  		if(tweetsQueue.length) {
			  			var tweetData = tweetsQueue.pop();
			  			$(compiledTemplates['tweet'](tweetData)).prependTo('#results').fadeIn();
			  		}
			  	}

			  	var t = setInterval(function() {
			  		renderTweet();
			  	},2000);

			  	//bind UI events
		  		$('#track_tag_btn').click(function() {
		  			socket.emit('trackTag',{tagName: $('#tagName').val()});
		  		});
		  	});
		</script>

	</body>
</html>